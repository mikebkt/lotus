var moment = require('moment');
var uuid = require('uuid');
var crypto = require('crypto');
var fs = require('fs');

/* read actual file CL_Integration.pdf */

// const base64hash = crypto.createHash('sha1').update(base64pdf).digest('base64')

/* pre-computed hash of CL_Integration.pdf*/
// const base64hash = "fmxvlOQ34EOTQjDAsJnedUtsYOI=";

const timestampMs = 1602719641000; // moment()
const timestamp = Math.round(timestampMs.valueOf() / 1000);
const method = 'POST';
const scheme = 'http';
const hostname = 'demoapi.cyberhsm.vn';
const port = 80;
const hostAndPort = hostname + ':' + port;
const resource = '/api/xml/verify';
const contentType = 'application/json;charset=UTF-8';
const apiKey = '47dd2c92dfa246899d2c92dfa2868986';
const nonce = uuid.v4(); // "0f96edba-4b9a-4bf2-ad3f-da3d9783fbba" //
const timestampStr =
  moment(timestampMs).format('ddd, DD MMM yyyy HH:mm:ss') + ' GMT';

let body =
  'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PGNhdGFsb2c+CiAgIDxib29rIGlkPSJiazEwMSI+CiAgICAgIDxhdXRob3I+R2FtYmFyZGVsbGEsIE1hdHRoZXc8L2F1dGhvcj4KICAgICAgPHRpdGxlPlhNTCBEZXZlbG9wZXIncyBHdWlkZTwvdGl0bGU+CiAgICAgIDxnZW5yZT5Db21wdXRlcjwvZ2VucmU+CiAgICAgIDxwcmljZT40NC45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMC0xMC0wMTwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+QW4gaW4tZGVwdGggbG9vayBhdCBjcmVhdGluZyBhcHBsaWNhdGlvbnMgCiAgICAgIHdpdGggWE1MLjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTAyIj4KICAgICAgPGF1dGhvcj5SYWxscywgS2ltPC9hdXRob3I+CiAgICAgIDx0aXRsZT5NaWRuaWdodCBSYWluPC90aXRsZT4KICAgICAgPGdlbnJlPkZhbnRhc3k8L2dlbnJlPgogICAgICA8cHJpY2U+NS45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMC0xMi0xNjwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+QSBmb3JtZXIgYXJjaGl0ZWN0IGJhdHRsZXMgY29ycG9yYXRlIHpvbWJpZXMsIAogICAgICBhbiBldmlsIHNvcmNlcmVzcywgYW5kIGhlciBvd24gY2hpbGRob29kIHRvIGJlY29tZSBxdWVlbiAKICAgICAgb2YgdGhlIHdvcmxkLjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTAzIj4KICAgICAgPGF1dGhvcj5Db3JldHMsIEV2YTwvYXV0aG9yPgogICAgICA8dGl0bGU+TWFldmUgQXNjZW5kYW50PC90aXRsZT4KICAgICAgPGdlbnJlPkZhbnRhc3k8L2dlbnJlPgogICAgICA8cHJpY2U+NS45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMC0xMS0xNzwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+QWZ0ZXIgdGhlIGNvbGxhcHNlIG9mIGEgbmFub3RlY2hub2xvZ3kgCiAgICAgIHNvY2lldHkgaW4gRW5nbGFuZCwgdGhlIHlvdW5nIHN1cnZpdm9ycyBsYXkgdGhlIAogICAgICBmb3VuZGF0aW9uIGZvciBhIG5ldyBzb2NpZXR5LjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTA0Ij4KICAgICAgPGF1dGhvcj5Db3JldHMsIEV2YTwvYXV0aG9yPgogICAgICA8dGl0bGU+T2Jlcm9uJ3MgTGVnYWN5PC90aXRsZT4KICAgICAgPGdlbnJlPkZhbnRhc3k8L2dlbnJlPgogICAgICA8cHJpY2U+NS45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMS0wMy0xMDwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+SW4gcG9zdC1hcG9jYWx5cHNlIEVuZ2xhbmQsIHRoZSBteXN0ZXJpb3VzIAogICAgICBhZ2VudCBrbm93biBvbmx5IGFzIE9iZXJvbiBoZWxwcyB0byBjcmVhdGUgYSBuZXcgbGlmZSAKICAgICAgZm9yIHRoZSBpbmhhYml0YW50cyBvZiBMb25kb24uIFNlcXVlbCB0byBNYWV2ZSAKICAgICAgQXNjZW5kYW50LjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTA1Ij4KICAgICAgPGF1dGhvcj5Db3JldHMsIEV2YTwvYXV0aG9yPgogICAgICA8dGl0bGU+VGhlIFN1bmRlcmVkIEdyYWlsPC90aXRsZT4KICAgICAgPGdlbnJlPkZhbnRhc3k8L2dlbnJlPgogICAgICA8cHJpY2U+NS45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMS0wOS0xMDwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+VGhlIHR3byBkYXVnaHRlcnMgb2YgTWFldmUsIGhhbGYtc2lzdGVycywgCiAgICAgIGJhdHRsZSBvbmUgYW5vdGhlciBmb3IgY29udHJvbCBvZiBFbmdsYW5kLiBTZXF1ZWwgdG8gCiAgICAgIE9iZXJvbidzIExlZ2FjeS48L2Rlc2NyaXB0aW9uPgogICA8L2Jvb2s+CiAgIDxib29rIGlkPSJiazEwNiI+CiAgICAgIDxhdXRob3I+UmFuZGFsbCwgQ3ludGhpYTwvYXV0aG9yPgogICAgICA8dGl0bGU+TG92ZXIgQmlyZHM8L3RpdGxlPgogICAgICA8Z2VucmU+Um9tYW5jZTwvZ2VucmU+CiAgICAgIDxwcmljZT40Ljk1PC9wcmljZT4KICAgICAgPHB1Ymxpc2hfZGF0ZT4yMDAwLTA5LTAyPC9wdWJsaXNoX2RhdGU+CiAgICAgIDxkZXNjcmlwdGlvbj5XaGVuIENhcmxhIG1lZXRzIFBhdWwgYXQgYW4gb3JuaXRob2xvZ3kgCiAgICAgIGNvbmZlcmVuY2UsIHRlbXBlcnMgZmx5IGFzIGZlYXRoZXJzIGdldCBydWZmbGVkLjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTA3Ij4KICAgICAgPGF1dGhvcj5UaHVybWFuLCBQYXVsYTwvYXV0aG9yPgogICAgICA8dGl0bGU+U3BsaXNoIFNwbGFzaDwvdGl0bGU+CiAgICAgIDxnZW5yZT5Sb21hbmNlPC9nZW5yZT4KICAgICAgPHByaWNlPjQuOTU8L3ByaWNlPgogICAgICA8cHVibGlzaF9kYXRlPjIwMDAtMTEtMDI8L3B1Ymxpc2hfZGF0ZT4KICAgICAgPGRlc2NyaXB0aW9uPkEgZGVlcCBzZWEgZGl2ZXIgZmluZHMgdHJ1ZSBsb3ZlIHR3ZW50eSAKICAgICAgdGhvdXNhbmQgbGVhZ3VlcyBiZW5lYXRoIHRoZSBzZWEuPC9kZXNjcmlwdGlvbj4KICAgPC9ib29rPgogICA8Ym9vayBpZD0iYmsxMDgiPgogICAgICA8YXV0aG9yPktub3JyLCBTdGVmYW48L2F1dGhvcj4KICAgICAgPHRpdGxlPkNyZWVweSBDcmF3bGllczwvdGl0bGU+CiAgICAgIDxnZW5yZT5Ib3Jyb3I8L2dlbnJlPgogICAgICA8cHJpY2U+NC45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMC0xMi0wNjwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+QW4gYW50aG9sb2d5IG9mIGhvcnJvciBzdG9yaWVzIGFib3V0IHJvYWNoZXMsCiAgICAgIGNlbnRpcGVkZXMsIHNjb3JwaW9ucyAgYW5kIG90aGVyIGluc2VjdHMuPC9kZXNjcmlwdGlvbj4KICAgPC9ib29rPgogICA8Ym9vayBpZD0iYmsxMDkiPgogICAgICA8YXV0aG9yPktyZXNzLCBQZXRlcjwvYXV0aG9yPgogICAgICA8dGl0bGU+UGFyYWRveCBMb3N0PC90aXRsZT4KICAgICAgPGdlbnJlPlNjaWVuY2UgRmljdGlvbjwvZ2VucmU+CiAgICAgIDxwcmljZT42Ljk1PC9wcmljZT4KICAgICAgPHB1Ymxpc2hfZGF0ZT4yMDAwLTExLTAyPC9wdWJsaXNoX2RhdGU+CiAgICAgIDxkZXNjcmlwdGlvbj5BZnRlciBhbiBpbmFkdmVydGFudCB0cmlwIHRocm91Z2ggYSBIZWlzZW5iZXJnCiAgICAgIFVuY2VydGFpbnR5IERldmljZSwgSmFtZXMgU2Fsd2F5IGRpc2NvdmVycyB0aGUgcHJvYmxlbXMgCiAgICAgIG9mIGJlaW5nIHF1YW50dW0uPC9kZXNjcmlwdGlvbj4KICAgPC9ib29rPgogICA8Ym9vayBpZD0iYmsxMTAiPgogICAgICA8YXV0aG9yPk8nQnJpZW4sIFRpbTwvYXV0aG9yPgogICAgICA8dGl0bGU+TWljcm9zb2Z0IC5ORVQ6IFRoZSBQcm9ncmFtbWluZyBCaWJsZTwvdGl0bGU+CiAgICAgIDxnZW5yZT5Db21wdXRlcjwvZ2VucmU+CiAgICAgIDxwcmljZT4zNi45NTwvcHJpY2U+CiAgICAgIDxwdWJsaXNoX2RhdGU+MjAwMC0xMi0wOTwvcHVibGlzaF9kYXRlPgogICAgICA8ZGVzY3JpcHRpb24+TWljcm9zb2Z0J3MgLk5FVCBpbml0aWF0aXZlIGlzIGV4cGxvcmVkIGluIAogICAgICBkZXRhaWwgaW4gdGhpcyBkZWVwIHByb2dyYW1tZXIncyByZWZlcmVuY2UuPC9kZXNjcmlwdGlvbj4KICAgPC9ib29rPgogICA8Ym9vayBpZD0iYmsxMTEiPgogICAgICA8YXV0aG9yPk8nQnJpZW4sIFRpbTwvYXV0aG9yPgogICAgICA8dGl0bGU+TVNYTUwzOiBBIENvbXByZWhlbnNpdmUgR3VpZGU8L3RpdGxlPgogICAgICA8Z2VucmU+Q29tcHV0ZXI8L2dlbnJlPgogICAgICA8cHJpY2U+MzYuOTU8L3ByaWNlPgogICAgICA8cHVibGlzaF9kYXRlPjIwMDAtMTItMDE8L3B1Ymxpc2hfZGF0ZT4KICAgICAgPGRlc2NyaXB0aW9uPlRoZSBNaWNyb3NvZnQgTVNYTUwzIHBhcnNlciBpcyBjb3ZlcmVkIGluIAogICAgICBkZXRhaWwsIHdpdGggYXR0ZW50aW9uIHRvIFhNTCBET00gaW50ZXJmYWNlcywgWFNMVCBwcm9jZXNzaW5nLCAKICAgICAgU0FYIGFuZCBtb3JlLjwvZGVzY3JpcHRpb24+CiAgIDwvYm9vaz4KICAgPGJvb2sgaWQ9ImJrMTEyIj4KICAgICAgPGF1dGhvcj5HYWxvcywgTWlrZTwvYXV0aG9yPgogICAgICA8dGl0bGU+VmlzdWFsIFN0dWRpbyA3OiBBIENvbXByZWhlbnNpdmUgR3VpZGU8L3RpdGxlPgogICAgICA8Z2VucmU+Q29tcHV0ZXI8L2dlbnJlPgogICAgICA8cHJpY2U+NDkuOTU8L3ByaWNlPgogICAgICA8cHVibGlzaF9kYXRlPjIwMDEtMDQtMTY8L3B1Ymxpc2hfZGF0ZT4KICAgICAgPGRlc2NyaXB0aW9uPk1pY3Jvc29mdCBWaXN1YWwgU3R1ZGlvIDcgaXMgZXhwbG9yZWQgaW4gZGVwdGgsCiAgICAgIGxvb2tpbmcgYXQgaG93IFZpc3VhbCBCYXNpYywgVmlzdWFsIEMrKywgQyMsIGFuZCBBU1ArIGFyZSAKICAgICAgaW50ZWdyYXRlZCBpbnRvIGEgY29tcHJlaGVuc2l2ZSBkZXZlbG9wbWVudCAKICAgICAgZW52aXJvbm1lbnQuPC9kZXNjcmlwdGlvbj4KICAgPC9ib29rPgo8U2lnbmF0dXJlIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjIj48U2lnbmVkSW5mbz48Q2Fub25pY2FsaXphdGlvbk1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDEvUkVDLXhtbC1jMTRuLTIwMDEwMzE1Ii8+PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSIvPjxSZWZlcmVuY2UgVVJJPSIiPjxUcmFuc2Zvcm1zPjxUcmFuc2Zvcm0gQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwLzA5L3htbGRzaWcjZW52ZWxvcGVkLXNpZ25hdHVyZSIvPjwvVHJhbnNmb3Jtcz48RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnI3NoYTEiLz48RGlnZXN0VmFsdWU+NC9uWGhqdEJRaGh2WFROTlNOcS9jSmdiNHNRPTwvRGlnZXN0VmFsdWU+PC9SZWZlcmVuY2U+PC9TaWduZWRJbmZvPjxTaWduYXR1cmVWYWx1ZT5pNFRSNVJSRWFXNDZQamxyT2h2YmRBVjN5MVRGd0NyUFg1VHdVUkE5VG4rMHVhTGZXaWFEUS9UWmEyZW5SUVBaS0xLd1AzemRaN3FyJiMxMzsKejVCbkIrTkdnVER5ci9Tc1pId0tRQXhCSndpWDNrWCtZZEYzOWdQc2JrUEJDK0c4VWRreFovZmRsNGxFekVqUi9QeXUzZkE2WkdkbCYjMTM7Ci94TThBUDJOYWRIT0xXbjlTYXFRanE2Ty9udXlOdklWOWpRbHluT1dtUi9nNFJta2gyQ2NKTjkvVkhzTlFmN0ZaYkJRRHYvMTIxSHAmIzEzOwpnYVNwL2o4L0lhMXh5cVFpZ3I4VVR3MzU3QWJWSDVZZEhKVHhYUFFnVkJ4ZlowOTR6TzlRMzdkQVgwWU02S1NoaEIwcFBZNDdBZkVXJiMxMzsKeldxQTlJQTFqWlB5R25ZUkRtYitvTDhXeDBiaTZRaTJveS9xR3c9PTwvU2lnbmF0dXJlVmFsdWU+PEtleUluZm8+PEtleVZhbHVlPjxSU0FLZXlWYWx1ZT48TW9kdWx1cz5xL2JJbTIzOS9DdGNyUlNJaXZ5VEdhQTAvQkc3dUNQcCtZZmR5TzlVL2ROYkhoZnR0Z1Brc3V6cXlXVXYrZWFXZVZkZHBpcXlNaGNUJiMxMzsKL1dVdkdmSmJRNzdxTVpMSS9WQ0ZvSmpSYnE5emlEYXg3aERsYVd3WEdDVmhMNWpPeXluY3ZEWmhWaWNrTFc2aWhrdWFMTXJCSWQvVCYjMTM7CnBFNXNYVi9MYlFkYnJ6VGJCd3VVWEVzcjFWM2VIaDlDeEhzbXlpQ2daL0FLSml5NEFLSDRaVGdVUFR1UTlkbnYrQXFkU0hvdkFITlUmIzEzOwpzVExNOEUrWUhrSGFJRzgrcndvM1Q3KzJpa2lDdzgvQVBqNllQUVd6d1FoS2tvRFFiTDFsdCtzZ3BUaklrNFFTbzdScWd0aVJtK2g2JiMxMzsKc0pLZVBmYlpuLzVyc3hsQVNSZDBwbktVWXdTRzFsdHVCeWZ6a1E9PTwvTW9kdWx1cz48RXhwb25lbnQ+QVFBQjwvRXhwb25lbnQ+PC9SU0FLZXlWYWx1ZT48L0tleVZhbHVlPjxYNTA5RGF0YT48WDUwOUNlcnRpZmljYXRlPk1JSUVuRENDQTRTZ0F3SUJBZ0lRVkFFQkNSOFJ1ZzRpQldJbkhUd0FBakFOQmdrcWhraUc5dzBCQVFVRkFEQmZNU1l3SkFZRFZRUUQmIzEzOwpEQjFNYjNSMWMwTkJJRVJwWjJsMFlXd2dVMmxuYm1GMGRYSmxJRk5LUXpFb01DWUdBMVVFQ2d3ZlE4T1VUa2NnVkZrZ1ErRzdsQ0JRJiMxMzsKU09HNnBrNGdRMWxDUlZKTVQxUlZVekVMTUFrR0ExVUVCaE1DVms0d0hoY05NakF3TlRFeU1Ea3dNalEzV2hjTk1qRXdOVEV6TURrdyYjMTM7Ck1qUTNXakEvTVI0d0hBWUtDWkltaVpQeUxHUUJBUk1PVFZOVU9qQXhNak0wTlRZM09Ea3hFREFPQmdOVkJBTVRCMEpHUkVaSFJFY3gmIzEzOwpDekFKQmdOVkJBWVRBbFpPTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFxL2JJbTIzOS9DdGNyUlNJJiMxMzsKaXZ5VEdhQTAvQkc3dUNQcCtZZmR5TzlVL2ROYkhoZnR0Z1Brc3V6cXlXVXYrZWFXZVZkZHBpcXlNaGNUL1dVdkdmSmJRNzdxTVpMSSYjMTM7Ci9WQ0ZvSmpSYnE5emlEYXg3aERsYVd3WEdDVmhMNWpPeXluY3ZEWmhWaWNrTFc2aWhrdWFMTXJCSWQvVHBFNXNYVi9MYlFkYnJ6VGImIzEzOwpCd3VVWEVzcjFWM2VIaDlDeEhzbXlpQ2daL0FLSml5NEFLSDRaVGdVUFR1UTlkbnYrQXFkU0hvdkFITlVzVExNOEUrWUhrSGFJRzgrJiMxMzsKcndvM1Q3KzJpa2lDdzgvQVBqNllQUVd6d1FoS2tvRFFiTDFsdCtzZ3BUaklrNFFTbzdScWd0aVJtK2g2c0pLZVBmYlpuLzVyc3hsQSYjMTM7ClNSZDBwbktVWXdTRzFsdHVCeWZ6a1FJREFRQUJvNElCY2pDQ0FXNHdEQVlEVlIwVEFRSC9CQUl3QURBZkJnTlZIU01FR0RBV2dCU2gmIzEzOwpMekRETDFyZlV0YVdjbnZJWnlYaUQxYkZKREEzQmdnckJnRUZCUWNCQVFRck1Da3dKd1lJS3dZQkJRVUhNQUdHRzJoMGRIQTZMeTlrJiMxMzsKWlcxdmIyTnpjQzVzYjNSMWMyTmhMbU52YlRBU0JnTlZIUkVFQ3pBSmdRZHpkbVJBWm1ocU1Eb0dBMVVkSUFRek1ERXdMd1lNS3dZQiYjMTM7CkJBR0I3UU1CQ1FNQk1COHdIUVlJS3dZQkJRVUhBZ0l3RVF3UFQxTmZTRk5OWDBONVltVnlYekZaTURRR0ExVWRKUVF0TUNzR0NDc0cmIzEzOwpBUVVGQndNQ0JnZ3JCZ0VGQlFjREJBWUtLd1lCQkFHQ053b0REQVlKS29aSWh2Y3ZBUUVGTUU4R0ExVWRId1JJTUVZd1JLQXFvQ2lHJiMxMzsKSm1oMGRIQTZMeTlrWlcxdlkzSnNMbXh2ZEhWelkyRXVZMjl0TDJ4dmRIVnpZMkV1WTNKc29oYWtGREFTTVJBd0RnWURWUVFEREFkTSYjMTM7ClQxUlZVME5CTUIwR0ExVWREZ1FXQkJRVnQreis5a2JuVkQyeEtmaGdhUm5JYWxrK2lEQU9CZ05WSFE4QkFmOEVCQU1DQlBBd0RRWUomIzEzOwpLb1pJaHZjTkFRRUZCUUFEZ2dFQkFBRFVoald4RmVCU1Bwc3l2UC9BWmd0TmNIZm1qQmlIWmhLYmd6R2tUd1JNeTViT3RmZFAxN1pqJiMxMzsKMnM1cFZzaGxVdGtLS2dYQXJmNVBTYlBGTmhqdWY5bk1UOTVxNVppckU0MGxqZktYUmc5eEpzd2NzaFYrZ1ZlRUVxQSsyYTlSTHJ1cyYjMTM7CnkwWWt6RVJRWEZUMHdQcjVGM3krRkdNS1NWVU85dlpIdTBaQVRkd2xWL1ZPUW1sbml2dU9SL2NybWp6Qkt1NTB4ZUsyWmdscFlPWXomIzEzOwpTcXFkbTV5L2VrUVROMlM2b0xHNEJyM0pVM2Jub2FHU2crbUpVVmtRMFNSWTVDUjlKbnFadDVWNEoxdzNpVU1HVlRMSU0ra2w4SjRRJiMxMzsKcXJodlVYY0VYTWtQOU9wVGFyMTd0aTVwTHZTS0d0TzNOM3ByQU8wUEEwanQ5L1BCR3ZrdEZLVmp5Rm89PC9YNTA5Q2VydGlmaWNhdGU+PFg1MDlDZXJ0aWZpY2F0ZT5NSUlFdGpDQ0FwNmdBd0lCQWdJUVZBRUJDUm9TNUxIVkdralJ5VG9NdXpBTkJna3Foa2lHOXcwQkFRc0ZBREJxTVRFd0x3WURWUVFEJiMxMzsKRENoRGVXSmxja3h2ZEhWeklFUnBaMmwwWVd3Z1UybG5ibUYwZFhKbElDQktVME1nVWs5UFZFTkJNU2d3SmdZRFZRUUtEQjlEdzVSTyYjMTM7ClJ5QlVXU0JENGJ1VUlGQkk0YnFtVGlCRFdVSkZVa3hQVkZWVE1Rc3dDUVlEVlFRR0V3SldUakFlRncweE9URXdNVFF4TWpBMU5EUmEmIzEzOwpGdzB6TkRFd01UUXhNakExTkRSYU1GOHhKakFrQmdOVkJBTU1IVXh2ZEhWelEwRWdSR2xuYVhSaGJDQlRhV2R1WVhSMWNtVWdVMHBEJiMxMzsKTVNnd0pnWURWUVFLREI5RHc1Uk9SeUJVV1NCRDRidVVJRkJJNGJxbVRpQkRXVUpGVWt4UFZGVlRNUXN3Q1FZRFZRUUdFd0pXVGpDQyYjMTM7CkFTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTHVTQXJpTGo2anE5aHBTVE1uWFdtZTA3YVdndExoU1lVRE4mIzEzOwpnT1ZPT3N0aFNJR21WTjZwamVHTkg1MTFxUjdHV3VzVWMrU0hoaEZPeXBHRWt4WHdoZzQySEZ4TzVra2ZPblFJdGxwdU1icUhmSS92JiMxMzsKUXd4ZXI1SUx3TlZTbzRFZy9GYmZobWpyYzJybjVsRVAzN3ZTT0NRc2YwTURDZHVEYnprMlM0SVdlLy83TkNpYUdHaVBBRzhJY1YxRSYjMTM7CjNkUEUxRFFpQ3NEcFl0N0xmQWMyRzRXRWE5Q2NmbVk4bHU2NXMrMzBhZGVlTzA0UE5SWWE3UFZyVDFVQXdpckFYaFlQOW1yOG5vVWEmIzEzOwoyQXhsaFIxeXZLMFl3MkQzTURFbkQ2L0J2c3F5UkJGQ3FDM0lGYUlTUUpvRTdwZXhlWFlObzArZVJKRXZRQlFzV2xqL1ZjUmVpbXBuJiMxMzsKZ0w4Q0F3RUFBYU5qTUdFd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZkJnTlZIU01FR0RBV2dCUWJkdk1mcUpncWZkeXNQMWxSR0dYZCYjMTM7CjB4aUdMVEFkQmdOVkhRNEVGZ1FVb1M4d3d5OWEzMUxXbG5KN3lHY2w0ZzlXeFNRd0RnWURWUjBQQVFIL0JBUURBZ0dHTUEwR0NTcUcmIzEzOwpTSWIzRFFFQkN3VUFBNElDQVFBb3I5dlpUNFBKRjFxeWpFNyt6bHBWUDZ1eFdrR2E5RmQ1cmtUelVZRTVVZFRHSnJPNjVoOHkyU0xjJiMxMzsKOTc2bjhteEtoZTUzU3BBUnhpUXQxZGNBdGxQOU5odlNzTTU4Y2tQY2F6WG9pYkExdXluMW1yS0gvWWprY1E2TVQ1Qml1eEdJdnIyTCYjMTM7CjlFSkJnaUhvZUNaRWJ5MGtzUDh6VTZ4Q0k2alAwajhEeXA3YkdCMkh1cVpsRjZjU2UvQmhHYjBwcno0US9oRWcxT2pVVXdsNkV6cU4mIzEzOwpycXlGaUxIR25MVmlZNEtERFVnZkxYV1BEZzNheGtIcm82U0hrK0tyLy9aWlZLNDluSGkwdXpMTlBMTHJGdHFBUWtqNVpDWHUraGUrJiMxMzsKWU45SHI3ek9NOEtJdWZ0clRUQkdzc2pnVm9XV3h6ZWl6S0x5L2N5SzQ0eWRDZzk4ajVwRk9GVDhGOTZVaG40eVlWS2w2aVI3cE94YyYjMTM7Cmp1b3NhMVZKbXpWYjJUcm9QcEowK0pEdnpzcEtEOGdId0xhQVhFSHZmK2taRDdQaU1iWitybDRmZmxTTEFQVWR2MnN2cDhRdkJYWjMmIzEzOwprYzhyQS9HYUI3QXRLeE80bWxTSUdSb0lGcGRCS0F6Q05MQkJuNGdlNWNBSHRhYnR2NWd1R0xCdGRZZGZ4QW93K3FSbTlKK2ZVR1ozJiMxMzsKQWtZOGFMYTZXYzlxT3ZrSCsyb1V4L29KajJQSXU2VW5TM2d3amRFeWhpcnNRMUpobXRhSWJzNnV6STAvSTJRVU5KWGJaNGVjNUFPdyYjMTM7Cng2bTd3OTJZUkt0MEtMNHNZWUlHQWxYMFIvUHBuSVNIWWdmZlByaVM4UkZzcDN5Y2NwYUk2MWw1OUduOXg3R0ZMRXJtNDRnYUZjTjAmIzEzOwpUZlI1L3QrM1lLOW5zNHpXTlE9PTwvWDUwOUNlcnRpZmljYXRlPjxYNTA5Q2VydGlmaWNhdGU+TUlJRndUQ0NBNm1nQXdJQkFnSVFWQUVCQ1pqR25pSm1Fb0dQdWJFc3dqQU5CZ2txaGtpRzl3MEJBUXNGQURCcU1URXdMd1lEVlFRRCYjMTM7CkRDaERlV0psY2t4dmRIVnpJRVJwWjJsMFlXd2dVMmxuYm1GMGRYSmxJQ0JLVTBNZ1VrOVBWRU5CTVNnd0pnWURWUVFLREI5RHc1Uk8mIzEzOwpSeUJVV1NCRDRidVVJRkJJNGJxbVRpQkRXVUpGVWt4UFZGVlRNUXN3Q1FZRFZRUUdFd0pXVGpBZUZ3MHhPVEV3TVRReE1qQXdOVFphJiMxMzsKRncwek9URXdNVFF4TWpBd05UWmFNR294TVRBdkJnTlZCQU1NS0VONVltVnlURzkwZFhNZ1JHbG5hWFJoYkNCVGFXZHVZWFIxY21VZyYjMTM7CklFcFRReUJTVDA5VVEwRXhLREFtQmdOVkJBb01IMFBEbEU1SElGUlpJRVBodTVRZ1VFamh1cVpPSUVOWlFrVlNURTlVVlZNeEN6QUomIzEzOwpCZ05WQkFZVEFsWk9NSUlDSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQWc4QU1JSUNDZ0tDQWdFQWxyaytWVy9XS0RONnh4ZWpVTHU0JiMxMzsKb0IrbGRvLzdCL1dTSHdHYUVPVFBQeDF2SkxCTVlsWmRqVzFFd28vdnphck16M2FsbW1xandzd3c3cGQrSng5dUtzLzBnRnRZN0E0MyYjMTM7Cnd1ekx6VnF1ZytxRnNjZldqZlZYcmpBeDhlMzduZXh4ejRDc2daSW1ERlBYNlN3R2FUbDJyeXhFQ1hWV2NHaEtWRjBMMTFqeVVwdEEmIzEzOwpUUDBYaGtuQzRWditzdC9SSU1EV096NHordDl2NGlVRVFab2VHQ0xjK29HdllPa2V4a051Sm5HSmFsa3FIemdZK3dXNDhicWE0ckgrJiMxMzsKTk02RzZ2S2ZZdGRtalRJTDkwMkU2am42UG1BQmFjVlBCZm1XZHAvZ2VBcTR3TTZtR1UrTTJYc1ZEMmMwRnFBUFcvVzg1MUdWWjZEdiYjMTM7CldqMEdnK0o4UWlDcHkxSGFtRmVnTjdEQUduSUt2MGNPT2s3SXdCSFNqWlFXUWM5d3Ura09VaCtlbWk4UytoQk9FZU1qUTV5V3E5dXImIzEzOwpHczlVcXhia2sya2IwM2tQVVNRalM2cW92cmU3VEFWWnBZV0l2d25jRlFZU2RXa1B4blhMTVQxMmxSQVJ1TkdpdGxGeDBzOEo1N2dkJiMxMzsKQTFhL2IyR0RRbXB2cER4WEZuT1hFdmR4cnlpTk1mZVlvMndUU3RDbWc2cHpMbHhKMkt6cklkWmdQRXpTM0NxVHc4azlwaHI4d1JxTiYjMTM7CkxIT1hORjRvRW1JcFdwcGxTdW5Pd1dIazBGVkhVL2FSajdlak9sNE9wMDFkNGtRSFdldElLNi9mMGxISzk5VmsyR0dPNm53MDNGSEQmIzEzOwpGV3Noalp0VHY1VTBEcXB0V05RSU9PM1FrRVZ0VlBZUjlKM3RQOTkxaWM5WlNBdDBCTitZZkVVQ0F3RUFBYU5qTUdFd0R3WURWUjBUJiMxMzsKQVFIL0JBVXdBd0VCL3pBZkJnTlZIU01FR0RBV2dCUWJkdk1mcUpncWZkeXNQMWxSR0dYZDB4aUdMVEFkQmdOVkhRNEVGZ1FVRzNieiYjMTM7Ckg2aVlLbjNjckQ5WlVSaGwzZE1ZaGkwd0RnWURWUjBQQVFIL0JBUURBZ0dHTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFDQkdNdkkmIzEzOwpacUVWR0lkUTNZNGZ3cE8xMDVFbWNEUzBVMzc3N2hwakF0TnhhS1FBNm5OSVFPZnNlVll2VzB5eEllcWdPV2tDOS8zRFJ2V2ptR1hzJiMxMzsKS1ZuVlhrdE8wTmhRRmpmNTVFclRJeTFIRzFKV09jaTRmeERDdG1hc0JsdmE1ZnR6RTNialdoZUg2akZKVVphaWpiNUd0UVdsd1N4RiYjMTM7Ck1iTCsvcXBDN0c0MlgwUXpoN1ZKRHVzdWw3bFhDamg3cVd2Q3hIVW5wajEvZkdjcnk2UXphYW44TEF2bDJCNmJhYTRaNXhTUmoxSEsmIzEzOwphUXBFcmhBZ1lYcXg5VEV2RS9uc3pOY2dYaWJNQ1pHekExcDBETERpTEFXTEMvYWZoMFd6djBYRnZpaVFDTkxWSUFrZndHcmxmWlluJiMxMzsKS2QwaXRITWExL0J3RDJueDBSa0pSL0hXSStld2hVNmE5RnhLRS9CeUtTYVEwYUdLTVhEMGcrc3kvTmc0ZXV3MVFibEhpVmpheDJzUSYjMTM7CjM5dGFRbytoUktvdWZiRmlnV3krOVJkV1dOV3RkQTdWZnpCeFQ1UlUwWFFHN1BLUTFmbWY3eTNZblBaYkQ5SkttYk5wV3Z0czIxaHEmIzEzOwpzTzVUeTJ5clh5S0E4aDg4UnF1YXRpcElLMGZSeVhDWHlMZngvdXVnaFJZOTFoRkx5aHE3R3pobGtVNGkzdUZkc1ZCUkZKUEMzNGdlJiMxMzsKS2NaaGVrWlEwbC9TbXI5TnpYOE10QklHUkZmMEUySUFtVVJja0xKeCtlVkI0SzhWQlhQZy9XbG4vMDJPTiszUW1TeURFamRtd2o5VyYjMTM7CkF1bjB5MkVpL0JMaXRMVFdDcUtJenF0VE54Yjk3NEwyTi9hSnFjbHpSWlAwQVY2UGV2U1A4YjJOZ0RkSzJ5RWt0aVlyZ0E9PTwvWDUwOUNlcnRpZmljYXRlPjwvWDUwOURhdGE+PC9LZXlJbmZvPjwvU2lnbmF0dXJlPjwvY2F0YWxvZz4=';

// body = (new Buffer(body, 'base64'));

var hmacBuilder = crypto.createHmac(
  'SHA256',
  new Buffer(
    'MjhmYzdhZDkxZjI4ZWI2Y2FmNWIxYmEyMWRjNmMxMzM4NjI1Y2JmZDEzNjE2MWRhNWFkZmZkNjViNjAxYTk4Zg==',
    'base64'
  )
);

hmacBuilder
  .update(method, 'utf8')
  .update('\n')
  .update(scheme, 'utf8')
  .update('\n')
  .update(hostAndPort, 'utf8')
  .update('\n')
  .update(resource, 'utf8')
  .update('\n')
  .update(contentType, 'utf8')
  .update('\n')
  .update(apiKey, 'utf8')
  .update('\n')
  .update(nonce, 'utf8')
  .update('\n')
  .update(timestampStr, 'utf8')
  .update('\n')
  .update(body)
  .update('\n');

const signatureDigest = hmacBuilder.digest('base64');

/**
 * Log
 */
// console.log("method: ", method);
// console.log("scheme: ", scheme);
// console.log("host: ", hostAndPort);
// console.log("resource: ", resource);
// console.log("content-type: ", contentType);
// console.log("apiKey: ", apiKey);
// console.log("nonce: ", nonce);
// console.log("timestampStr: ", timestampStr);
// console.log("body: ", body);
// console.log("bodyInfo: ", bodyInfo);
// console.log("signatureDigest: ", signatureDigest);

const signature =
  'HmacSHA256' +
  ' ' +
  apiKey +
  ':' +
  nonce +
  ':' +
  signatureDigest +
  ':' +
  timestamp;
console.log('signature: ', signature);
console.log('Date: ', timestampStr);

/**
 * Req
 */
const http = require('http');

const options = {
  hostname: hostname,
  port: 80,
  path: resource,
  method: 'POST',
  headers: {
    'Content-Type': contentType,
    Authorization: signature,
    Date: timestampStr,
  },
};

const req = http.request(options, (res) => {
  // console.log(res)
  // console.log(`statusCode: ${res.statusCode}`);
  // res.setEncoding('utf8');
  res.on('data', (d) => {
    process.stdout.write(d);
  });
});

req.write(body);

req.on('error', (error) => {
  // console.error(error)
});

req.end();
